<!DOCTYPE HTML>
<html lang="ja">
<head>
<title>変更点・新機能｜AutoHotkey v2</title>
<meta name="description" content="AutoHotkey開発の現在のブランチによって導入された変更点および新機能。" />
<meta name="ahk:equiv-v1" content="AHKL_ChangeLog.htm" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="static/theme.css" rel="stylesheet" type="text/css" />
<script src="static/content.js" type="text/javascript"></script>
</head>
<body>
<h1>変更点・新機能</h1>
<p><a href="v2-changes.htm">v1.1からv2.0への変更点</a>は、v1.1とv2.0の相違点をカバーしています。</p>
<p>変更点の技術的な詳細については、<a href="https://github.com/AutoHotkey/AutoHotkey/tree/alpha">GitHub</a>を参照してください。</p>

<h2 id="v2.0.15">2.0.15 - 2024年5月16日</h2>
<p>v2.0.14以降、誤ったページングのために、DBGp property_getがプロパティを取得できない問題を修正しました。</p>
<p>v2.0.14 以降、DBGpプロパティを評価するときにTry without Catchが失敗する問題を修正しました。
</p>
<p>v2.0.14以降、&lt;base&gt;デバッガの擬似プロパティが参照をリークする問題を修正しました。</p>

<h2 id="v2.0.14">2.0.14 - 2024年5月6日</h2>
<p>テキストがフォーカスされているときでも文字キーのショートカットを処理するようにエラーダイアログを修正しました。</p>
<p>MonthCalコントロールの横に複数月を表示するW-<em>n</em>オプションがDPIスケーリングの影響を受けないように修正しました。</p>
<p>Click関数が整数を返す問題を修正しました。</p>
<p><code><i>key</i>::try {</code>がエラーとして検出される問題を修正しました。</p>
<p>ホットストリング<code>:B0*O:XY::Z</code>が、XZではなく正しくXYZと出力されるように修正しました。</p>
<p>Fixed Send to leave any prior <code>{<i>modifier</i> Down}</code> in effect even if the key happens to be physically held down.</p>
<p>メニューポップアップが表示されたときにフォーカスするスクリプトの信頼性が向上しました。</p>

<p><strong>デバッガの改善：</strong></p>
<p>保留中のレスポンスを別のコマンドの処理中に送信されるstdout/stderrパケットが損なわないように修正しました。</p>
<p><code>property_get -n &lt;exception&gt;.message</code>などを修正しました。</p>
<p>プロパティが<code>x.y.z</code> where <code>y =&gt; {z:"a"}</code>のような文字列を含むテンポラリオブジェクトを返すときに、property_getが返す結果の不具合を修正しました。</p>
<p>コマンドの処理中に別の非同期コマンドを受信するとクラッシュしてしまう問題を修正しました。</p>
<p>例外がproperty_setによって抑制された後に削除されない問題を修正しました。</p>
<p><code>property_get -c 0 -d 0</code>が<code>-d 1</code>で既に許可されているようにグローバル変数を使用できるようにを修正しました。</p>
<p>Fixed property_get paging enumerated items incorrectly.</p>

<p>Improved property_get to support property getters with one parameter (previously only the implicit __Item property supported this).</p>
<p>Improved property_get to support properties of primitive values. The value must still be contained by a variable or returned from a property.</p>
<p>パラメータを&lt;=1にすることで関数を呼び出せるようにproperty_getを改善しました。</p>
<p>Improved property_get to support float keys/parameters.</p>

<p>プロパティの評価中に例外を抑制するように変更しました。</p>
<p>__Enumがスローしたエラーを項目なしとみなして無視するようにデバッガを変更しました。</p>
<p>Changed the &lt;enum&gt; pseudo-property to require __Enum. これにより、オブジェクト自体がEnumratorとして呼び出されなくなりました。</p>
<p>Small code size optimizations in the debugger.</p>

<h2 id="v2.0.13">2.0.13 - 2024年4月20日</h2>
<p>Hotkey関数に無効なオプションが含まれているときにValueErrorをスローするように変更しました。</p>
<p>バックスペースがやり直しに割り当てられているときに+Sオプションを参照するようにInputHook関数を修正しました。</p>
<p>列挙中のプロパティを安全に削除できるようにデバッガを修正しました。</p>
<p>エラーダイアログのテキストなど、OLEクリップボードの内容が終了時に失われる問題を修正しました。</p>
<p> <code>ホットキー "a pu"</code>のような、無効な接尾辞の検出を修正しました。</p>
<p>Fixed DllCall <code>AStr*</code> arg type to copy back only if address changes.</p>
<p>Fixed #Include to correctly "close" any built-in variable it reads (no known impact on real-world scripts).</p>
<p>Fixed WinTitles with two different ahk_id values to yield no match.</p>

<h2 id="v2.0.12">2.0.12 - 2024年3月23日</h2>
<p>Guiにオーナーウィンドウまたは+DPIScaleがある場合のGui GetPos/GetClientPosを修正しました。</p>
<p>ファイルループでのサブフォルダーの再帰を防止するようにUntil文を修正しました。</p>
<p>Fixed DllCall to throw when arg type is UStr.</p>
<p>regEx calloutのたびにメモリリークが起きるのを修正しました。</p>
<p>Fixed Send erroneously releasing a modifier due to a race condition. For example, <code>~LAlt::Send "{Blind}x"</code> intermittently released LAlt if some other keyboard hook was installed more recently than the script's own hook.</p>
<p>Fixed icon loader to prefer higher bit-depth when multiple bitmaps of the same size are present.</p>
<p>Fixed SendInput failing to release LCtrl if it had already released RAlt and the layout does not have AltGr.</p>
<p>Fixed key-up hotkeys not firing if the key repeats after modifiers change. For example, <code>F1::Send "{Ctrl down}"</code> should allow <code>F1 up::</code> to execute when the key is released even though Ctrl is down, but was not allowing it after key-repeat occurs.</p>
<p>#IfWinではなく#HotIfを参照するようにエラーメッセージを修正しました。[PR #327]</p>
<p>Fixed OwnProps erroneously skipping properties with optional parameters.</p>
<p>Fixed inconsistent behaviour of cloned dynamic properties.</p>
<ul>
  <li>OwnProps not skipping cloned properties which require parameters.</li>
  <li>Parameters not being passed recursively to parameterless properties (i.e. to allow <code>a.b[c]</code> to evaluate as <code>(a.b)[c]</code>).</li>
</ul>
<p>Windowsがセーフモードの場合など、ネットワークサブシステムが機能していないときに重大なエラーが発生するSysGetIPAddresses関数を修正しました。 </p>
<p>コンソールウィンドウがアクティブな場合など、フォーカスを決定できない場合に ControlGetFocus関数が0を返すように変更しました。</p>

<h2 id="v2.0.11">2.0.11 - 2023年12月23日</h2>
<p>Windows 10で最初に表示されるメニューがキーボード入力を受け付けない場合の回避策を追加しました。</p>
<p>DateTimeコントロールが短い日付形式を使えるように<a href="lib/Gui.htm#Add">Add method (Gui)</a>を修正しました。</p>
<p>Fixed a reference counting error with multi-level function nesting.</p>
<p>Fixed <code>#include &lt;x&gt;</code> causing a load-time crash if used inside a function.</p>
<p><code>ListView.Opt("NoSort")</code>を修正しました。</p>
<p>プロパティを持たないオブジェクトが複製されたときに発生するメモリリークを修正しました。</p>
<p>Fixed #include and FileInstall (non-compiled) to compare file names <a href="https://learn.microsoft.com/en-us/windows/win32/intl/handling-sorting-in-your-applications#sort-strings-ordinally">ordinally</a>, not linguistically.</p>

<h2 id="v2.0.10">2.0.10 - 2023年9月24日</h2>
<p>Fixed crashing when a named function hotkey is used after #HotIf.</p>
<p>数値リテラルがドットで終わるときに行が継続しないように修正しました。</p>
<p>Fixed pre-increment/decrement to work with chained array indexing.</p>
<p>Fixed OnNotify/OnCommand applying styles only applicable to OnEvent.</p>
<p>Fixed FileExist/DirExist leaking handles when <code>emptydir\*</code> is used.</p>
<p>Fixed DirExist leaking handles when only files match.</p>

<h2 id="v2.0.9">2.0.9 - 2023年9月17日</h2>
<p>Fixed stacking of hotstrings with the X option.</p>
<p>Fixed debugger not listing local vars if the function is at the bottom of the stack.</p>
<p>Fixed Gui threads to show on the debugger's call stack.</p>
<p>Fixed some combinations of &amp;/ByRef causing stack overflow in ExitApp.</p>

<h2 id="v2.0.8">2.0.8 - 2023年9月11日</h2>
<p>Fixed ByRef parameters erroneously assigning the default value to the caller's VarRef if unset.</p>
<p>Fixed some issues affecting suppressed Alt/Ctrl/Shift/Win hotkeys, such as:</p>
<ul>
  <li><code>*LCtrl::</code> blocked LCtrl from the active window, but sending Alt-key combinations would fail because the system thinks Ctrl is down, and would therefore send WM_KEYDOWN instead of WM_SYSKEYDOWN.</li>
  <li><code>*LAlt::</code> caused the system to forget any prior <code>{LAlt DownR}</code>, so a remapping such as <code>LCtrl::LAlt</code> would not behave correctly while LAlt is physically down, even though LAlt was suppressed.</li>
  <li>Other potential issues where the system's low-level tracking of a modifier key doesn't match up with the logical state.</li>
</ul>
<p>Fixed some issues affecting continuation sections:</p>
<ul>
  <li>Escape sequences in the Join option were translated twice, causing <code>````</code> to become one literal <code>`</code> instead of two, <code>``n</code> to become a linefeed, and similar.</li>
  <li><code>`"</code> or <code>`'</code> produced a literal backtick and ended the string, instead of producing a literal quote mark, if the continuation section was enclosed in quotes of the same type and lacked the <code>`</code> option.</li>
</ul>
<p>Optimized the automatic escaping of quote marks and backtick in continuation sections.</p>
<p>Fixed breakpoint_list (debugger) returning duplicates on lines containing fat arrow functions.</p>
<p>Fixed <code>+BackgroundDefault</code> failing to override the Gui's BackColor property.</p>

<h2 id="v2.0.7">2.0.7 - 2023年9月2日</h2>
<p>X1とY1を省略できるようにMouseClickDrag関数を修正しました。</p>
<p>Fixed mouse AltTab hotkeys not suppressing execution of a prefix hotkey, such as <code>1::</code> for <code>1 &amp; WheelDown::AltTab</code>. （v2.0.4で生じた不具合）</p>
<p>Fixed hook hotkeys not recognizing modifiers which are pressed down by SendInput.</p>
<p>Fixed A_AhkPath to not be reliant on the case/format of the command line used to launch the process.</p>
<p>Fixed heap corruption during window searches involving groups. （v2.0.6で生じた不具合）</p>
<p><strong>ランチャー</strong></p>
<p>Fixed #Requires not being detected if followed by a comment other than <code>; prefer <i>xxx</i></code>. （v2.0.6で生じた不具合）</p>
<p>複数行にわたって自動で置換するホットストリングを誤って解釈する構文チェックを修正しました。</p>
<p><strong>Window Spy</strong></p>
<p>Changed font to Segoe UI size 9, consistent with Dash.</p>

<h2 id="v2.0.6">2.0.6 - 2023年8月30日</h2>
<p>x.yがx.y()として振る舞ってしまうなどのCOM呼び出しの曖昧さを修正しました。</p>
<p>Fixed breakpoint on control flow statement being "hit" when a fat arrow function on the line below it returns.</p>
<p>Fixed <code>Default :</code> to not merge with the line below it. This prevented <code>Default :</code> from being used at the end of a Switch block, and caused any subsequent line to take the line number of the Default.</p>
<p>プロセスへのアクセスが拒否されたときでも、有効なPIDが与えられた場合に全てのプロセスをスキャンしないようにProcessGetPath関数、ProcessSetPriority関数、および ProcessClose関数を最適化しました。</p>
<p><code>LWin::Alt</code>を使用しても一部のAltキーの組み合わせを有効にできない問題を修正しました。</p>
<p><code>x is y</code>がスローするTypeErrorを「Object」ではなく「Class」と表示するように修正しました。</p>
<p>1023文字を超える条件をサポートするようWinTitleを修正しました。</p>
<p><code>&amp;ref</code> が同じ変数の異なるエイリアスで使用されている場合の問題を修正しました。</p>
<p>Fixed optional parameter default expressions (other than simple literal values) preventing the use of assume-global/assume-static.</p>

<h2 id="v2.0.5">2.0.5 - 2023年8月12日</h2>
<p>オブジェクトがCOM経由で列挙されたときに、誤った参照カウントがメモリリークを引き起こす問題を修正しました。[PR# 325]</p>
<p>__Enumへの内部呼び出しが__Callを呼び出していたのを修正しました。</p>
<p>パラメータ#65535を参照するエラーメッセージを修正しました。</p>
<p>Fixed incorrect IEnumVARIANT return count.</p>
<p>Download関数がOSErrorのエラーコードが0以外にもかかわらず、OSError(0)をスローするのを修正しました。</p>
<p>ListViewコントロールのAdd/Insert/Modifyメソッドに最小数のパラメータが渡されたときにクラッシュする問題を修正しました。</p>
<p>スタックトレースがErrorサブクラスの__newへの呼び出しを除外するように修正しました。</p>

<h2 id="v2.0.4">2.0.4 - 2023年7月3日</h2>
<p>エラー/警告ダイアログのリロードボタンを、現在のスクリプトインスタンスが終了していなくても、明示的にダイアログを閉じるように変更。</p>
<p><code>finally</code>ブロック内でアクセスすると変数が空白に表示される原因となっていた<code>return var</code>の最適化を削除。</p>
<p>デフォルト(Switch)でコロンの前にスペースが入るように修正。</p>
<p>Array.Prototype.RemoveAtで、Lengthが<code>unset</code>または<code>var?</code></p>
<p>ComObjectが2番目の変数のみ指定されたforループに渡されるとクラッシュする問題を修正。</p>
<p><strong>v1.1.37.00およびv1.1.37.01からの変更をマージ：</strong></p>
<p>COMのメソッドとプロパティの呼び出しで、大きな整数をVT_R8（浮動小数点）ではなくVT_I8として渡すように変更。32ビット範囲の整数はVT_I4として渡される。</p>
<p>IDispatchでラップされたAutoHotkeyオブジェクトで、多変数の列挙子（for-loop）のサポートを追加しました。オブジェクトを呼び出すスクリプトとオブジェクト自体の両方が、サポートされているAutoHotkeyバージョンを実行している必要があります。</p>
<p>AutoHotkeyメソッドがIDispatch（COM）を介して呼び出された場合、省略されたパラメータが「オプション引数マーカー」ではなく、デフォルト値を受け取るように修正されました。逆変換は、以前のバージョンでCOMメソッドを<em>呼び出す</em>ときにすでに行われていた。</p>
<p><code>VerCompare(a, "&gt;" b)</code>を修正し、コードサイズをわずかに縮小。</p>
<p>AltTab関連のロードタイムエラーを他のエラーと矛盾しないように修正。</p>
<p>ComObjectラッパーがオブジェクト/COM経由で呼び出された場合にスローされるエラーが正しく伝搬されない問題を修正。</p>
<p>ホットキーGUIコントロールを修正し、記号 <code>^</code>, <code>!</code>と<code>+</code>をホットキーとして設定できるようにした。</p>
<p>ホットキーコントロールの値がシンボルに設定されている場合、修飾子が含まれるように修正。</p>
<p>InputHook.KeyOpt()が単一の文字で誤動作する可能性があったのを修正しました。</p>
<ul>
<li>オプションの削除は、対応するSCに影響を与えない可能性がある。</li>
<li>オプションはsc000にも適用される可能性がある。</li>
</ul>
<p>カスタムコンボで、<code>a &amp; b::</code>、<code>a::</code>、<code>a up::</code>のようなホットキーのセットが、#HotIfで<code>a::</code>だけが無効になっている場合、<kbd>a</kbd>のリリースを抑制できないバグを修正。</p>
<p>キーダウンイベントがホットキーによって正しく抑制されるが、SendLevel &gt; 0で追加のキーダウンを送信すると、送信されたイベントが#InputLevelによって無視されても、それに続くキーアップが抑制されないというバグを修正した。</p>
<p><code>a &amp; b::</code> が存在するが #HotIf によって無効化されている場合、<code>a &amp; b up::</code>が <kbd>b</kbd>を抑制しないように修正。</p>
<p>競合状態によりホットキーが起動しない問題を修正しました。もし<code>~*RWin::</code>のようなモディファイアホットキーがSendやGetKeyStateを呼び出すのが早すぎると、OSはRWinがダウンしていないと報告する可能性があり、フックのモディファイアの状態が「修正」され、ホットキーが誤って発火したり、発火しなかったりします。この現象は、他のキーボードフックがスクリプト自身のフックよりも最近にインストールされた場合にのみ発生する可能性がある。その場合、他のフックのスレッドが再開して戻るまで、OSはキーの状態を更新しないからだ。</p>
<p>ホットストリングが#HotIfで設定されたLast Found Windowを使用するように修正した。</p>
<p>OSが自動的にフックをアンインストールした場合、キーボードまたはマウスフックを再インストールしようとすると失敗する問題を修正しました。このような試みを行うには、やはり一定の条件を満たす必要がある。</p>
<p>組み込み IDispatch 用にキャッシュされた COM プロパティ名の割り当てが最適化されました。</p>
<p>DLL として AutoHotkey のビルド設定をサポートするようにコードをリファクタリングしました。</p>

<h2 id="v2.0.3">2.0.3 - 2023年6月19日</h2>
<p><code>Hotkey("a", "b")</code>が "a"ではなく、"b"の本来の機能を使うように修正。[PR #318]</p>
<p>FileSetAttribute をファイル読み込みループで使用するとクラッシュする問題を修正しました。[PR #323]</p>
<p>GUIコントロール名の重複エラーを修正し、スレッドを正しく中断するようにした。</p>
<p>DateTime/MonthCal Rangeオプションで最小値が適用されない問題を修正。</p>
<p><code>s[x] =&gt; x</code>と"s"で始まる他の単一行のプロパティを修正。</p>
<p><code>=&gt;</code>を含む静的行のブレークポイントを削除する際のバグを修正。</p>
<p>ボタンコントロールをクリックするとデフォルトにならない問題を修正</p>
<p>PixelSearchでピクセルが見つからなかった場合にXをセットしないように修正。</p>
<p>エスケープシーケンスが次の行をスキップするホットストリングを修正。</p>
<p>WinTitleで "ahk_"が2文字目にある場合、1文字目を無視するように修正。</p>
<p>右手モディファイアーがすでにダウンしていることを利用するようにリマッピングを修正。例えば、<code>+x::+yは</code>、RShiftを離してLShiftを押すことができなくなります。</p>
<p><code>a == b &amp;&amp; c(</code>)と同様の場合のエラーメッセージを変更し、レガシー<code>=</code>を暗示しないようにしました。</p>
<p>意図しない行が続く場合のエラーメッセージを改善。</p>
<p>ドキュメントにあるように、予約語をメソッド名として許可するように修正しました。</p>
<p>一部のキーボード・メッセージのOnMessage呼び出しが重複していたのを修正しました。</p>
<p>相互参照されたクロージャが早期に削除される問題を修正しました。</p>
<p>SetFontを修正し、Optionsパラメータの先頭のスペースを許可するようにしました。</p>
<p><code>{ASC nnnn}</code>の送信を修正しました。</p>
<p><code>a.base := a</code>がエラーをスローするように修正しました。</p>
<p><code>x.y := unset</code>がクラッシュや未定義の動作を引き起こす問題を修正しました。</p>
<p>GUIがその親でない場合でも、GuiControl.Move()がGUIのクライアント領域に対して相対的になるように修正しました。</p>
<p>メニュー追加で、メニュー挿入で追加された項目が上書きされるのを修正しました。</p>
<strong>ランチャー</strong>
<p>パラメータなしで実行した場合、ドキュメントの古いウェルカムページを表示する代わりにDashを実行します。</p>
<p>バージョン選択GUIで、バージョンを選択せずにEnterキーを押すとエラーが発生する問題を修正しました。[PR UX/#4]</p>
<p>不在のバージョンがダウンロード可能かどうかをチェックする際のエラーを抑制しました。</p>
<p>UACが無効になっている場合、UACシールドを表示しないよう、不在バージョンのダウンロードプロンプトを修正しました。</p>
<p>#Requiresディレクティブの解釈に関する問題を修正しました。</p>
<ul>
<li>接頭辞"v"の省略をサポートしました。</li>
<li>演算子として<code>&gt; &gt;= &lt; &lt;= =</code>をサポートしました。</li>
<li>バージョンは1桁をサポート。</li>
</ul>
<strong>インストール</strong>
<p>コマンドライン用のデフォルトのインストールディレクトリを修正しました。</p>
<p>スタートメニューのショートカットの名前を "AutoHotkey" から "AutoHotkey Dash" に変更しました。</p>
<p>SYSTEMとして実行中のEnableUIAccessを修正しました。</p>
<p>証明書の選択時にEnableUIAccessが秘密鍵を検証するように修正しました。</p>
<strong>Dash</strong>
<p>Launch Config GUIを修正して「管理者として実行」および「UIアクセスで実行」オプションを更新しました。</p>
<p>Launch Config GUI上でのUp/Downキーの処理を修正しました。</p>

<h2 id="v2.0.2">2.0.2 - 2023年1月2日</h2>
<p>Short DllCall の arg タイプと、無効なタイプに対する未定義の挙動を修正しました。</p>
<p>AutoHotkeyバイナリの非文字列のファイルバージョン番号を修正しました。</p>
<p>パラメータタイプのエラーで、正しいパラメータ番号が表示されるように修正しました。</p>

<h2 id="v2.0.1">2.0.1 - 2023年1月1日</h2>
<p>Func.IsOptional(1)が0を返すべきでない場合があるのを修正しました。</p>
<p>Guiイベントハンドラ関数で、Guiがそれ自身のイベントシンクである場合に、Guiパラメータをドロップしないように修正しました。</p>
<p>COMのエラーで、説明文がない場合に「(null)」が表示されないように修正しました。</p>
<p>ToolTipが断続的に間違った位置に表示されるのを修正しました。</p>
<p>Array、Match、Guiで2つ目の変数を許可するように __Enum(unset)を修正ました。</p>
<p>#include&lt;&gt;のエラーメッセージが「関数ライブラリ」ではなく「スクリプトライブラリ」と表示されるように修正しました。</p>
<p>新規スレッドでCriticalによるメッセージチェックを防止できない問題を修正しました。</p>
<p>DllCallの型名の変換を最適化しました。</p>
<p>些細ですが効果的なコードサイズの最適化を行いました。</p>

<h2 id="Pre-Release">プレリリース</h2>
<p>v2.0.0リリース以前の変更履歴は、以下を参照してください（ただし、一部の変更は上書きされていることにご注意ください）。</p>
<ul>
  <li><a href="https://www.autohotkey.com/boards/viewtopic.php?f=24&amp;t=110696">v2.0リリース候補</a></li>
  <li><a href="https://www.autohotkey.com/boards/viewtopic.php?f=24&amp;t=95688">v2.0ベータ版リリース</a></li>
  <li><a href="https://www.autohotkey.com/boards/viewtopic.php?f=37&amp;t=2120">v2.0アルファ版リリース</a></li>
</ul>
</body>
</html>